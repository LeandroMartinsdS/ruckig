// For format details, see https://aka.ms/devcontainer.json. For config options, see the README at:
// https://github.com/microsoft/vscode-dev-containers/tree/v0.194.0/containers/ubuntu
{
    "name": "ruckig devcontainer",
    "build":{
        "dockerfile": "../docker/Dockerfile",
        "context": "..",
        "target": "build"
    },
    "remoteUser": "${localEnv:VSCODE_REMOTE_USER}",
    // Add the IDs of extensions you want installed when the container is created.
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.vscode-pylance",
                "tamasfe.even-better-toml",
                "redhat.vscode-yaml",
                "ryanluker.vscode-coverage-gutters",
                "charliermarsh.ruff",
                "ms-vscode.cmake-tools",
                "ms-vscode.cpptools",
                "ms-azuretools.vscode-docker",
                "mhutchie.git-graph",
                "tomoki1207.pdf"
            ]
        }
    },
    "features": {
        // Some default things like git config
        "ghcr.io/devcontainers/features/common-utils:2": {
            "upgradePackages": false
        }
    },

    "runArgs": [
        "-e HOME",
        "--net=host",
        "--security-opt=label=disable",
        "--userns=keep-id",
        "--annotation=run.oci.keep_original_groups=1",
        "--storage-opt=ignore_chown_errors=true",
        "--runtime=/usr/bin/crun"
    ],

    // Mount the parent of the project folder so we can access peer projects
    "workspaceMount": "source=${localWorkspaceFolder}/..,target=/workspaces,type=bind",
    "mounts": [
        // "source=/dls,target=/dls,type=bind,consistency=cached,bind-propagation=shared",
        // "source=/dls_sw,target=/dls_sw,type=bind,consistency=cached,bind-propagation=shared",
        // "source=/home,target=/home,type=bind,consistency=cached,bind-propagation=shared",
        // "source=/scratch/,target=/scratch/,type=bind,consistency=cached",
        // "source=/tmp,target=/tmp,type=bind,consistency=cached",
        "source=/dev/shm,target=/dev/shm,type=bind",
        "source=${localEnv:SSH_AUTH_SOCK},target=${localEnv:SSH_AUTH_SOCK},type=bind,consistency=cached"
    ]

}